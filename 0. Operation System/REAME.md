# OS

## 운영체제 기초

**운영체제란 무엇일까요?**

- OS란 컴퓨터 시스템 자원을 효율적으로 관리하며 사용자가 컴퓨터를 효과적으로 사용 할 수 있는 환경을 제공하는 여러 프로그램의 모임. 단순히, Application과 HW 간의 인터페이스로써 다른 Application이 유용한 작업을 수행 하는 것을 도움

**운영체제의 기능**

- CPU 스케줄링
- 메모리 관리
- 파일 및 입출력 관리
- 프로세스 관리
- 네트워킹
- 보호

**운영체제가 관리하는 5가지 자원의 상세 개요**

**프로세스 관리**
- 프로세스의 스케줄링과 동기화 관리를 담당
- 프로세스의 생성 및 제거, 시작과 정지, 메시지 전달

**저장장치 관리**
- 1차 메인 메모리, 2차 HDD/SSD/NAND등 이 있다.
- 각 저장 장치를 관리하며 프로세스에게 메모리 할당 및 회수, 파일 생성 삭제, 변경, 유지등의 작업을 수행

**네트워킹**

- TCP/IP 기반의 인터넷에 연결하거나 응용프로그램이 네트워크를 사용하면 OS에서 네트워크 프로토콜을 지원함

**주변장치 관리**
- 마우스 키보드 등

**시분할 시스템, 다중 프로그래밍 시스템, 대화형 시스템**

- 시분할 시스템 : CPU 작업 시간 내에서 여러 프로그램이 나누어 쓰는 시스템을 시분할 시스템이라고 합니다.

- 다중 프로그래밍 시스템 : 여러 프로그램을 동시에 메모리에 적재하여 CPU 활용도를 극대화 합니다. CPU 유휴 상태 시간을 최소화하고 이를 작업이 입출력 기다리는 동안 다른 프로그램이 실행되게 함

- 대화형 시스템 : 즉각적인 처리를 위함 사용자가 직접 명령을 입력하고 이를 시스템이 즉각적으로 결과를 반환 함

**인터럽트/폴링**

- 인터럽트 : CPU가 작업중인 작업을 즉시 중단하고 다른 이벤트를 처리 할 수 있게끔 릴리즈를 합니다.

- 폴링 : CPU 상태를 주기적으로 확인하는 것으로 비효율적이다. 코드로 치면 동기식 코드에서 IO 파일 입출력 등을 실행 하는 꼴

**Mode Bit / System Call / DMA**

- Mode Bit : 운영 체제의 제어권을 구분하는 방식으로 사용자 모드와 커널 모드로 나눕니다.

- System Call : Application이 OS의 파일 시스템 또는 프로세스 제어를 요청 할 때 사용하는 매커니즘입니다.(OS Parameter를 수정해서 만일, 파일 읽는 버퍼를 늘린다던지 한 번에 열 수 있는 파일 갯수를 조절 한다 던 지 지정을 할 수 있습니다.)

- Function Call : System call은 운영체제 커널에 요청하는 호출이고 Function Call은 프로그램 내에서 함수로 호출하는 것 입니다.

- DMA : CPU 개입 없이 메모리와 입출력 장치간에 데이터를 직접 전송하는 방식 Direct Memory Access

## 프로세스와 스레드

**프로세스와 프로세서의 차이점**

- 프로세스는 코드로 작성된 프로그램이 메모리에 적재되어 사용 할 수 있는 상태가 된 것이다.
(.jar 파일 서버에 빌드해서 올리면 프로세스)

- 프로세서는 CPU를 의미한다.

**프로세스와 Thread 차이**

- 프로세스는 메모리에 적재된 하나의 프로그램을 의미함

- 스레드는 CPU에서 동작하는 가장 작은 단위의 작업

> 스레드는 프로세스가 할당 받은 자원을 이용하는 실행 단위

**프로세스의 주소 공간이 이루어지는 원리**

- 텍스트(코드) : 코드 자체를 구성하는 메모리 영역

- Data : 전역 변수/ 정적 변수

- stack : 지역변수, 매개변수, 리턴 값과 같은 데이터를 저장하는 임시 메모리 영역

- Heap : RunTime 시점에 동적으로 할당 되는 데이터들이 저장됨 (사용자 객체)

- 프로세스 주소 공간을 나눈 이유 : 최대한 데이터를 공유하면서 메모리 사용량을 최적화 하기 위해서 이다.

**프로세스가 Running Status 임에도 자원을 뺏기는 상황**
- Interrupt 발생
- IO Request를 하기 위해서 system call하여 waiting 상태로 넘어가는 경우
- Process가 끝난 경우

**PCB**

- 프로그램 카운터 / 레지스터 정보 / 프로세스 상태 등을 저장함 이걸로 프로세스 어떤 것을 수행 할 지등을 OS Scheduling 중에 알 수 있음

**멀티 스레딩 기법**

- 하나의 프로세스에 여러 스레드로 자원 공유하며 작업을 나누어 수행
- 독립적인 프로세스를 생성하는 것에 비해서 자원 사용량이 조금 더 이점이 있다.
- 스레드 사이 콘텍스트 스위칭 비용이 프로세스에 비해서 싸다.
- 논 블로킹과는 다른 의미인데 멀티 스레딩 기법으로 쓰더라도 파일 IO 앞에서는 해당 스레드는 waiting하게 된다. 이때, 자바에서는 NIO와 같은 라이브러리는 논 블로킹 방식으로 IO를 처리해서 IO 중에 다른 CPU 자원에 힘을 써줄 수 있다.

**멀티프로세싱 / 멀티 스레딩**

- VM 하나에서 여러 jar 파일 배포해서 병렬적으로 각자의 프로세스가 수행이 되면 멀티 프로세싱

- jar 파일 내부에서 ThreadPoolExecutor 같은 것을 활용해서 한 프로세스 내에서 여러 스레드가 나뉘어 작업 단위를 개선하면 멀티 스레딩

## CPU Scheduling

**장기/중기/단기 스케줄러**

- 장기 스케줄러 : 어떤 프로세스를 메모리에 올릴지 결정 함

메모리 할당 후 Ready Queue 에 진입 시키고 메모리에 올라가는 프로세스의 수를 조절함

- 중기 스케줄러 : 메모리의 올라간 프로세스의 수를 동적으로 조절하고 메모리 자원이 부족 할 때 일부 프로세스를 디스크로 스왑 아웃 시킴 (중지 상태로 변환)

- 단기 스케줄러 : 어떤 프로세스가 CPU를 사용 할 지 결정하는 역할 즉각적인 프로세스 전환을 꾀함

**선점형 비선점형 스케줄링**

- 비선점 : Process가 CPU를 놔줄 때까지 기다리는 방식 Process가 종료되거나 IO 하기 전 까지는 CPU를 지속적으로 사용함

선점형 : interrupt로 강제로 CPU를 뺏는 방식이다.
Race Condition 발생 가능

**RR(Round Robin)**

- 스케줄링 방식중 하나로 
CPU가 일정 시간을 사용하면 다른 프로세스로 교체 하는 방식입니다.

- TimeSlice : CPU가 최대로 사용 할 수 있는 최대 시간 이 시간 이후로는 준비 큐로 다시 돌아갑니다.
(선점형 스케줄링)

**임계 영역**

- 코드 단에서 설명하게 되면 ConcurrentHashMap으로 자체적으로 멀티 스레딩 기법으로 코드를 짤 때 전역 변수를 관리 할 수 있는데 해당 전역 변수가 Critical Section에 해당 되기 때문에 최대한 성능에 영향을 미치지 않고 Mutual 하게 쓰려고 한다.

**세마 포어 / 뮤츄얼 익스클루전**
- 동시성 제어를 위해서 사용되는 기법입니다.

- 레이스 컨디션과 같은 공유 자원 문제를 해결하려고 씁니다.

세마포어 : 공유 자원에 접근 할 수 있는 허가증을 제공하는 동기화 도구 입니다,
P 연산 : 세마 포어를 쓰기 위해서 자원을 사용 할 수 있게 -1 값으로 내림

V 연산 : 릴리즈 하는 의미로 다 쓰고 세마포어 값을 1 상승 시켜 다음 프로세스 (스레드)가 사용 할 수 있게끔 열어줍니다.

- 교착 상태 : 서로 다른 자원을 잡고 안 놔주는 경우 발생
만일, Thread A에서는 A자원을 쓰고 있는 도중에서 B 자원이 필요하고 Thread B에서는 B 자원을 쓰는 도중에 A 자원이 필요 한 경우 교착 상태에 들어서 진행이 되지 않는다.

뮤츄얼 익스클루전 : 하나의 프로세스 및 스레드만 사용 할 수 있게끔 보장함
lock / unlock으로 자원 사용


